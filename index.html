<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Easy Stone Optimizer</title>
    <style>
        :root { --bg: #f4f7f6; --dark: #2c3e50; --accent: #27ae60; --text: #333; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1200px; margin: auto; display: grid; grid-template-columns: 400px 1fr; gap: 30px; }
        .sidebar { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .canvas-area { background: white; padding: 20px; border-radius: 12px; border: 2px dashed #ccc; text-align: center; }
        .shape-selector { display: flex; gap: 10px; margin-bottom: 20px; }
        .shape-btn { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; background: #fff; }
        .shape-btn.active { border-color: var(--accent); background: #eafaf1; font-weight: bold; }
        .input-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        input { width: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .btn-primary { background: var(--accent); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-size: 1rem; cursor: pointer; margin-top: 10px; }
        .piece-entry { border-bottom: 1px solid #eee; padding: 15px 0; }
        .diagram { font-size: 0.8rem; color: #666; margin-bottom: 10px; background: #f9f9f9; padding: 10px; border-radius: 4px; line-height: 1.4; }
    </style>
</head>
<body>

<div class="container">
    <div class="sidebar">
        <h2>1. Slab Size</h2>
        <div class="input-row">
            <span>Length (in)</span> <input type="number" id="slabL" value="120">
        </div>
        <div class="input-row">
            <span>Width (in)</span> <input type="number" id="slabW" value="65">
        </div>

        <hr>

        <h2>2. Add Piece</h2>
        <div class="shape-selector">
            <button class="shape-btn active" onclick="setShape('rect', this)">Rect</button>
            <button class="shape-btn" onclick="setShape('lshape', this)">L-Shape</button>
            <button class="shape-btn" onclick="setShape('ushape', this)">U-Shape</button>
        </div>

        <div id="dynamicInputs">
            </div>

        <button class="btn-primary" onclick="addPieceToLayout()">Add to Slab</button>
    </div>

    <div class="canvas-area">
        <h3 style="margin-top:0">Live Layout Optimization</h3>
        <canvas id="mainCanvas" width="700" height="400"></canvas>
        <div id="stats" style="margin-top:20px; font-weight: bold; color: var(--dark);"></div>
    </div>
</div>

<script>
    let currentShape = 'rect';
    let pieces = [];

    function setShape(shape, btn) {
        currentShape = shape;
        document.querySelectorAll('.shape-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderInputs();
    }

    function renderInputs() {
        const container = document.getElementById('dynamicInputs');
        if (currentShape === 'rect') {
            container.innerHTML = `
                <div class="diagram">Standard rectangle.</div>
                <div class="input-row">Length <input type="number" id="p1" value="30"></div>
                <div class="input-row">Width <input type="number" id="p2" value="25"></div>`;
        } else if (currentShape === 'lshape') {
            container.innerHTML = `
                <div class="diagram">L-Shape:<br>A = Long side, B = Return side,<br>C = Depth of A, D = Depth of B</div>
                <div class="input-row">A (Length) <input type="number" id="p1" value="60"></div>
                <div class="input-row">B (Total Width) <input type="number" id="p2" value="40"></div>
                <div class="input-row">C (A Depth) <input type="number" id="p3" value="25"></div>
                <div class="input-row">D (B Depth) <input type="number" id="p4" value="25"></div>`;
        }
    }

    function addPieceToLayout() {
        const p1 = parseFloat(document.getElementById('p1').value);
        const p2 = parseFloat(document.getElementById('p2').value);
        let coords = [];

        if (currentShape === 'rect') {
            coords = [{x:0,y:0}, {x:p1,y:0}, {x:p1,y:p2}, {x:0,y:p2}];
        } else if (currentShape === 'lshape') {
            const p3 = parseFloat(document.getElementById('p3').value); // Depth A
            const p4 = parseFloat(document.getElementById('p4').value); // Depth B
            coords = [{x:0,y:0}, {x:p1,y:0}, {x:p1,y:p4}, {x:p3,y:p4}, {x:p3,y:p2}, {x:0,y:p2}];
        }

        pieces.push({ coords, color: `hsl(${Math.random() * 360}, 60%, 50%)` });
        draw();
    }

    function draw() {
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const slabL = document.getElementById('slabL').value;
        const slabW = document.getElementById('slabW').value;
        const scale = 5; // simplified scale

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Draw Slab
        ctx.strokeStyle = "#333";
        ctx.strokeRect(0, 0, slabL * scale, slabW * scale);

        // Simple tiling (for visualization)
        let offsetX = 0;
        pieces.forEach(p => {
            ctx.beginPath();
            ctx.fillStyle = p.color;
            p.coords.forEach((pt, i) => {
                if (i === 0) ctx.moveTo((pt.x + offsetX) * scale, pt.y * scale);
                else ctx.lineTo((pt.x + offsetX) * scale, pt.y * scale);
            });
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Move next piece over (very basic layout)
            const widths = p.coords.map(c => c.x);
            offsetX += Math.max(...widths) + 2;
        });
    }

    renderInputs();
</script>
</body>
</html>
